<!DOCTYPE html>
<html lang="en">

<head>
  	<title>Smartphone Controller Game</title>
	<script src="/socket.io/socket.io.js"></script>
  <script src="https://davidshimjs.github.com/qrcodejs/qrcode.min.js"></script>
</head>

<body>
  <p> Hello World! </p>
  <script>
	var io = io.connect();

  if (window.location.href.indexOf('?id=') > 0) {

    io.emit('controller_connect', window.location.href.split('?id=')[1]);

    io.on('controller_connected', function(bool) {
      if (bool) {
        console.log("Connected successfully to the game, " + window.location.href.split('?id=')[1]);
      } else {
        console.log("Could not connect to the game");
      }
    });


  } else {

    var qr = document.createElement('div');

    qr.id = "qr";
    document.body.appendChild(qr);

  	io.on('connect', function() {
    		io.emit('game_connect')
  	});

    var game_connected = function() {
      var url = "http://hips2.herokuapp.com?id=" + io.id;

      //Add QR-code
      var qr_code = new QRCode("qr");
      qr_code.makeCode(url);

      io.removeListener('game_connected', game_connected);
    };

    io.on('controller_connected', function(connected){

      if (connected) {
        qr.style.display = "none";
      }else{
        qr.style.display = "block";
      }

    });

    io.on('game_connected', game_connected);
  }
  </script>
</body>

</html>
