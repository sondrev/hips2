<!DOCTYPE html>
<html lang="en">

<head>
  	 <title>Smartphone Controller Game</title>
	   <script src="/socket.io/socket.io.js"></script>
     <script src="https://davidshimjs.github.com/qrcodejs/qrcode.min.js"></script>
     <script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>

</head>

<body>

  <script>
	var io = io.connect();

  if (window.location.href.indexOf('?id=') > 0) {
    document.write("<p> Hello frontend! </p>");

    io.emit('controller_connect', window.location.href.split('?id=')[1]);
    io.on('controller_connected', function(bool) {
      if (bool) {
        console.log("Connected successfully to the game, " + window.location.href.split('?id=')[1]);
      } else {
        console.log("Could not connect to the game");
      }
    });


  } else {
    //SPILL ENGINE
    var circle;
    var stage;
    function moveRight() {
      circle.x += 50;
    }
    function init() {
      stage = new createjs.Stage("canvas");
      circle = new createjs.Shape();
      circle.graphics.beginFill("Crimson").drawCircle(0, 0, 50);
      circle.x = 100;
      circle.y = 100;
      stage.addChild(circle);
      createjs.Ticker.setFPS(60);
      createjs.Ticker.addEventListener("tick", stage);
    }
    // -- SPLLLENGINE

    var qr = document.createElement('div');

    qr.id = "qr";
    document.body.appendChild(qr);

  	io.on('connect', function() {
    		io.emit('game_connect')
  	});

    var game_connected = function() {
      var url = "http://hips2.herokuapp.com?id=" + io.id;

      //Add QR-code
      var qr_code = new QRCode("qr");
      qr_code.makeCode(url);

      io.removeListener('game_connected', game_connected);
    };

    io.on('controller_connected', function(connected){

      if (connected) {
        qr.style.display = "none";
      }else{
        qr.style.display = "block";
      }

    });

    io.on('game_connected', game_connected);
  }
  </script>
</body>

</html>
